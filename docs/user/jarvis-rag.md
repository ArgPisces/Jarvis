# 📖 Jarvis RAG - 检索增强生成

<div align="center">
  <img src="../images/jarvis-rag.png" alt="Jarvis RAG" width="250" style="margin-bottom: 20px"/>
  
  *知识赋能的智能问答体验*
  
  ![Version](https://img.shields.io/badge/version-0.1.x-blue)
  ![Documents](https://img.shields.io/badge/文档格式-多格式支持-green)
</div>

## 🌟 魔法简介
Jarvis RAG 是一个基于检索增强生成技术的文档智能问答工具，能够处理和分析各种文档格式。通过向量化文档内容并利用语义搜索技术，它可以帮助您从大量文档中快速获取信息，并针对文档内容回答问题，提供基于知识的精准回复。

## ✨ 核心特性
- **多格式文档处理** - 支持PDF、DOCX、TXT等常见文档格式
- **文档索引构建** - 自动分析和向量化文档内容
- **语义搜索功能** - 根据含义而非简单关键词匹配查找内容
- **文档智能问答** - 基于文档内容回答用户提问
- **上下文感知理解** - 综合考虑文档间的关联信息
- **可定制忽略规则** - 通过 `.jarvis/rag_ignore.txt` 配置文件自定义索引时要忽略的文件和目录，提高索引效率与质量
- **Git仓库智能处理** - 自动检测Git仓库并只处理被Git管理的文件，确保只分析项目相关内容

## 💫 使用场景
- **文档知识库查询** - 快速检索大量文档中的特定信息
- **智能文档问答** - 针对文档提出问题并获取精准答案
- **研究资料分析** - 分析整理学术文献或研究资料
- **技术文档导航** - 在复杂技术文档中查找所需信息
- **知识库构建** - 构建和查询个人或团队知识库

## 🚀 使用方法
```bash
jarvis-rag [options]
```

### 📋 主要选项
- `--dir <路径>` - 指定文档目录（默认：当前目录）
- `--build` - 创建或更新文档索引
- `--search <查询>` - 在文档中搜索相关内容
- `--ask <问题>` - 根据文档内容回答问题

## 🔍 操作流程指南

### 📥 构建文档索引
首次使用或添加新文档后，需要构建或更新索引：
```bash
jarvis-rag --dir ~/documents/research --build
```

处理过程会显示进度：
```
正在处理目录: /home/user/documents/research
初始化环境... ✅
初始化配置... ✅
初始化数据目录... ✅
初始化模型... ✅
扫描文档目录...
发现 25 个文档文件
处理文档内容...
[████████████████████] 25/25 - 00:00:15
生成索引...
索引构建完成
```

#### 自定义忽略路径
您可以通过创建配置文件来自定义索引时要忽略的文件和目录：

1. 在项目根目录下创建 `.jarvis/rag_ignore.txt` 文件
2. 每行添加一个忽略模式，支持通配符（如 `*.pdf`、`logs/`）
3. 使用 `#` 开头的行添加注释

示例配置文件：
```
# 忽略特定目录
temp_data
logs
build

# 忽略特定文件类型
*.log
*.tmp
*.bak

# 忽略特定文件
secret_data.txt
```

默认情况下，系统已配置忽略常见的非文本文件和目录（如 `.git`、`__pycache__`、二进制文件等）。

### 🔎 搜索文档内容
在已索引的文档中搜索相关信息：
```bash
jarvis-rag --search "机器学习算法"
```

搜索结果会显示相关文档片段：
```
文件: /home/user/documents/research/ml_overview.pdf
片段 3/7
内容:
机器学习算法可以分为监督学习、无监督学习和强化学习三大类。监督学习
算法包括线性回归、逻辑回归、决策树、随机森林、支持向量机等，主要用
于分类和回归任务。无监督学习算法包括聚类算法、降维算法和关联规则算
法，用于发现数据中的隐藏模式。强化学习则通过奖励机制学习最优策略。

文件: /home/user/documents/research/deep_learning.txt
片段 1/5
内容:
深度学习是机器学习的一个子领域，基于人工神经网络构建复杂模型。常见
的深度学习架构有CNN（卷积神经网络）、RNN（循环神经网络）、
LSTM（长短期记忆网络）和Transformer等。
```

### 💬 文档问答
基于文档内容回答问题：
```bash
jarvis-rag --ask "机器学习在图像识别中的应用有哪些？"
```

系统会生成基于文档的回答：
```
答案:
根据文档内容，机器学习在图像识别中有以下几个主要应用：

1. 物体检测与识别：使用卷积神经网络(CNN)可以从图像中识别和定位不同物体。
   文档中提到："CNN模型如YOLO和Faster R-CNN在物体检测任务中取得了
   突破性进展，能够实时识别图像中的多个物体。"

2. 医学图像分析：在《医学影像AI应用》文档中指出，"深度学习模型可以
   分析X光片、CT和MRI扫描，帮助医生识别肿瘤、骨折和其他异常情况，
   提高诊断准确率。"

3. 人脸识别：文档《计算机视觉进展》描述："基于机器学习的人脸识别系统
   已达到超过人类的准确率，广泛应用于安全验证、人员跟踪和用户认证。"

4. 图像分割：文档提到："语义分割算法可以精确区分图像中的每个像素
   所属类别，在自动驾驶场景理解中发挥关键作用。"

5. 图像生成与增强：根据《生成对抗网络综述》，"GAN模型能够生成高质量
   的逼真图像，被用于图像修复、超分辨率重建和艺术创作。"

这些应用依赖于不同类型的机器学习算法，特别是深度学习模型，它们能够
自动学习图像的特征表示，从而执行各种复杂的视觉任务。
```

## 💎 支持的文档格式

| 格式 | 扩展名 | 特性支持 |
|------|--------|---------|
| **PDF** | .pdf | 文本提取 |
| **Word** | .docx, .doc | 文本提取 |
| **文本** | .txt, .md | 全文解析 |
| **HTML** | .html, .htm | 内容提取 |

## 💡 使用技巧
- **文档组织** - 将相关文档放在同一目录中，便于构建主题知识库
- **具体提问** - 提出明确、具体的问题比泛泛而问更容易获得准确答案
- **重建索引** - 在添加新文档后记得重新构建索引以包含新信息
- **问题测试** - 先尝试搜索相关内容，再针对结果提出具体问题
- **分块管理** - 将大量文档分成多个主题文件夹，按需索引和查询
- **优化索引范围** - 使用 `.jarvis/rag_ignore.txt` 排除不需要的文件，提高索引效率和质量
- **使用Git仓库** - 在Git仓库中使用工具可自动过滤掉未跟踪文件，专注于项目核心内容

## ⚙️ 配置选项

Jarvis RAG 提供了多种配置选项，让您可以根据需要自定义工具的行为。

### Git仓库支持

当在Git仓库中运行时，Jarvis RAG会自动检测并只索引被Git管理的文件：

- 自动检测当前目录是否为Git仓库
- 只处理已提交和已修改但未暂存的被跟踪文件
- 忽略未跟踪的文件和.gitignore中的文件
- 减少索引时间和资源消耗，聚焦于项目相关文件

这个特性对于大型代码库特别有用，可以避免索引临时文件、构建产物和其他非项目文件。

### 忽略文件配置 (.jarvis/rag_ignore.txt)

通过在项目根目录创建 `.jarvis/rag_ignore.txt` 文件，您可以自定义索引过程中要忽略的文件和目录：

```
# RAG 索引忽略文件配置
# 每行一个模式，支持通配符（* 匹配任意字符）
# 以 # 开头的行为注释

# 项目特定目录
logs
temp
cache
test_data

# 特定文件类型
*.bak
*.tmp
*.temp
large_binary_files.bin

# 特定文件
private_notes.txt
draft_document.md
```

**配置说明：**
- 每行一个忽略模式
- 支持目录名、文件名或带通配符的模式
- 路径匹配基于相对路径（相对于项目根目录）
- 既可以匹配文件名也可以匹配路径的任何部分
- 系统已有默认忽略模式（如 `.git`、`__pycache__`、二进制文件等）

如果没有找到配置文件，系统将使用默认忽略列表，包括常见的二进制文件、临时文件和版本控制目录等。

### 性能配置

可通过环境变量调整以下参数：
- `JARVIS_MIN_PARAGRAPH_LENGTH` - 最小段落长度（默认：50字符）
- `JARVIS_MAX_PARAGRAPH_LENGTH` - 最大段落长度（默认：12800字符）
- `JARVIS_THREAD_COUNT` - 处理线程数（默认：1）
- `JARVIS_MAX_TOKEN_COUNT` - 最大token数（默认：131072）

## 🔮 技术实现
- **向量数据库** - 使用FAISS存储和检索文档向量表示
- **文本嵌入** - 使用先进的文本嵌入模型生成语义表示
- **文档处理** - 专用解析器处理不同类型的文档格式
- **上下文构建** - 智能选择和组合相关文档片段
- **大语言模型** - 基于查询到的文档片段生成连贯、准确的回答

---

<div align="center">
  <p><i>Jarvis RAG - 释放文档知识的无限潜能</i></p>
</div>
