# 5. 使用指南

本章是 Jarvis 的实用操作手册，将详细介绍主要命令的用法、参数和常见场景示例。

## 5.1 通用代理 (`jarvis` / `jvs`)

`jvs` 是您的通用AI助手，适用于各种开放式、非特异性的任务。

### 核心能力
-   任务分析与规划
-   多工具协同
-   系统交互
-   方法论应用

### 常用参数
| 参数                | 描述                             |
| ------------------- | -------------------------------- |
| `-t`, `--task`      | 直接从命令行提供初始任务         |
| `-f`, `--config`    | 指定自定义配置文件的路径         |
| `--llm_type`        | 临时指定LLM类型 (`normal`/`thinking`) |
| `--restore-session` | 从保存的会话中恢复               |
| `-e`, `--edit`      | 快速编辑配置文件                 |

### 示例

**1. 交互式对话**
启动一个交互式会话，您可以像聊天一样分配任务。
```bash
jvs
```

**2. 直接执行任务**
让 Jarvis 分析当前项目结构并生成一份报告。
```bash
jvs -t "分析当前目录下的代码，总结项目的主要模块和功能"
```

**3. 解决环境问题**
当您遇到一个复杂的环境问题时，可以请求 Jarvis 帮助。
```bash
jvs -t "我的 docker 服务无法启动，请帮我诊断问题并尝试修复。相关日志在 /var/log/docker.log"
```

## 5.2 代码代理 (`jarvis-code-agent` / `jca`)

`jca` 是专为软件开发任务设计的代理，是您日常编码、重构和调试的得力助手。

### 核心能力
-   代码分析与修改
-   自动化代码审查
-   智能问题修复
-   与Git工作流集成

### 常用参数
| 参数                | 描述                             |
| ------------------- | -------------------------------- |
| `-r`, `--requirement` | 提供代码相关的需求描述           |
| `--llm_type`        | 临时指定LLM类型 (`normal`/`thinking`) |
| `--restore-session` | 从保存的会话中恢复               |

### 示例

**1. 添加新功能**
在项目中添加一个新功能，`jca` 会自动查找相关文件并进行修改。
```bash
jca -r "在用户认证模块中，增加一个'忘记密码'的功能。需要创建一个新的API端点 /api/forgot-password，并实现发送重置邮件的逻辑。"
```

**2. 修复 Bug**
根据 Bug 描述修复问题。
```bash
jca -r "修复 src/utils/calculator.py 中的除零错误。当除数为零时，应该返回一个错误提示而不是抛出异常。"
```

**3. 代码重构**
优化现有代码。
```bash
jca -r "重构 src/services/user_service.py 文件，将其中过长的 'create_user' 方法拆分为多个更小的私有方法，提高代码可读性。"
```

## 5.3 平台管理器 (`jarvis-platform-manager` / `jpm`)

`jpm` 是您与底层大模型平台交互和管理的工具。

### 子命令
-   `info`: 显示所有支持的平台和模型。
-   `chat`: 与指定的平台和模型进行交互式对话。
-   `service`: 将指定的模型以OpenAI兼容的API形式暴露出来。
-   `role`: 加载预定义的角色进行对话。

### 示例

**1. 查看可用模型**
```bash
jpm info
```

**2. 与特定模型聊天**
直接与Kimi进行对话，测试其性能。
```bash
jpm chat -p kimi -m k1.5
```

**3. 启动本地API服务**
将腾讯元宝模型封装为本地API，供其他应用调用。
```bash
jpm service --host 0.0.0.0 --port 8080 -p yuanbao -m deep_seek_v3
```

## 5.4 Git提交助手 (`jarvis-git-commit` / `jgc`)

`jgc` 能自动分析您的代码变更，并生成符合规范的 Git 提交信息。

### 核心能力
-   自动分析 `git diff`
-   生成规范的提交信息（类型、范围、主题）
-   自动暂存和提交

### 示例

当您完成了一些代码修改后，只需在项目根目录运行：
```bash
# 确保您已经通过 git add 将变更加入暂存区
git add .

# 运行 jgc
jgc
```
Jarvis 将会分析变更，生成一条类似 `feat(auth): add password reset endpoint` 的提交信息，并自动执行 `git commit`。

## 5.5 本地知识库 (`jarvis-rag` / `jrg`)

`jrg` 用于构建和查询基于您自己文档的本地知识库。

### 子命令
-   `add`: 添加文档（文件、目录、通配符）到知识库。
-   `list-docs`: 列出知识库中的所有文档。
-   `query`: 向您的知识库提问。

### 示例

**1. 构建知识库**
将整个项目代码和文档目录添加到知识库中。
```bash
jrg add ./src ./docs README.md
```

**2. 查询知识库**
基于您添加的文档，向 Jarvis 提问。
```bash
jrg query "在我们的项目中，'PlatformRegistry' 这个类是用来做什么的？它在哪个文件里定义的？"
```
这会让AI基于您的真实代码进行回答，而不是泛泛而谈。
