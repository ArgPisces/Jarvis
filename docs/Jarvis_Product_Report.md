# Jarvis AI 助手产品汇报

---

## 1. 产品概述

### 1.1 项目简介

Jarvis 是一款专为开发人员和高级用户设计的智能化开发与系统交互助手。它深度融合了大型语言模型（LLM）的理解与生成能力，以及强大的本地工具集，旨在自动化和简化从日常办公到复杂软件开发的全流程任务。

Jarvis 的核心设计理念是“AI Agent as a Tool”，即不仅将 AI 视为一个对话伙伴，更将其打造为一个能够自主规划、执行、反思并与本地环境深度交互的智能工具，从而成为用户在数字世界中的得力助手。

### 1.2 核心特性
- **零成本接入**: 无缝集成腾讯元宝、Kimi等多种免费或付费的大型语言模型，提供灵活选择。
- **工具驱动**: 内置丰富的工具集，涵盖代码分析、文件操作、脚本执行、网页搜索、虚拟终端控制等，赋予 AI 实际操作环境的能力。
- **高度可扩展**: 支持用户自定义工具、添加新的大模型平台以及通过 MCP 协议集成外部服务，具备无限扩展潜力。
- **人机协作**: 在自动化执行的同时，支持用户随时进行交互式干预和指导，确保 AI 的行为始终符合最终预期。
- **RAG 增强**: 内置检索增强生成（RAG）功能，可轻松构建基于本地文档（代码、笔记、文档）的专属知识库，让 AI 的回答更具针对性和准确性。
- **智能进化**: 内置方法论系统，能够从任务执行中学习和优化策略，实现“越用越智能”的自适应进化。

---

## 2. 系统架构

Jarvis 采用模块化的分层架构，确保了系统的灵活性、可扩展性和可维护性。

```plantuml
@startuml
!theme vibrant

package "用户接口层 (CLI)" {
  [jarvis]
  [jca]
  [jpm]
  [jgc]
  [jrg]
}

package "Agent 核心层" {
  [Jarvis Agent] as Agent
  Agent --> [会话管理器]
  Agent --> [Prompt 构建器]
  Agent --> [工具执行器]
}

package "功能模块层" {
  [代码 Agent] as CodeAgent
  [RAG 模块] as RAG
  [Git 工具集] as GitUtils
  [多 Agent 协作] as MultiAgent
}

package "工具层 (Tools)" {
  [文件操作]
  [代码读写]
  [脚本执行]
  [网页搜索]
  [虚拟终端]
  [自定义工具]
}

package "平台层 (Platforms)" {
  [平台注册表]
  [腾讯元宝]
  [Kimi]
  [OpenAI]
  [通义千问]
  [自定义平台]
}

package "配置与数据层" {
  [config.yaml]
  [向量数据库]
  [会话历史]
}

' --- 关系定义 ---
[jarvis] --> Agent
[jca] --> CodeAgent
[jrg] --> RAG

Agent --> CodeAgent
Agent --> RAG
Agent --> GitUtils
Agent --> MultiAgent

Agent --> [工具执行器]
[工具执行器] --> [文件操作]
[工具执行器] --> [代码读写]
[工具执行器] --> [脚本执行]
[工具执行器] --> [网页搜索]
[工具执行器] --> [虚拟终端]

Agent --> [平台注册表]
[平台注册表] --> [腾讯元宝]
[平台注册表] --> [Kimi]
[平台注册表] --> [OpenAI]

Agent --> [config.yaml]
RAG --> [向量数据库]
[会话管理器] --> [会话历史]

@enduml
```

---

## 3. 竞品分析

为了更好地定位 Jarvis 的市场价值和差异化优势，我们选取了市面上几款主流的 AI 编程助手进行对比。

| 特性 | Jarvis | GitHub Copilot | Cursor | Mentat / Claude Code |
| :--- | :--- | :--- | :--- | :--- |
| **产品形态** | 独立 CLI 工具集 | 主流 IDE 插件 | 定制化 IDE (Fork VSCode) | 独立 CLI 工具 |
| **核心交互** | **命令行对话** | GUI 聊天, 行内编辑 | GUI 聊天, `@`引用, 行内编辑 | **命令行对话** |
| **核心能力** | Agent 自主任务, **工具调用**, RAG, 代码生成/修改 | 代码补全, Chat 问答, Agent 自主任务 | 代码生成/编辑, Agent 自主任务, 调试 | Agent 自主任务, 代码生成/修改 |
| **上下文感知** | ✅ **项目级上下文**, ✅ **本地 RAG** | ✅ 工作区上下文, ✅ PR/Issue 上下文 | ✅ 项目级上下文, ✅ `@`符号引用 (文档/网页) | ✅ 项目级上下文 |
| **扩展性** | ✅ **自定义工具**, ✅ **自定义模型/平台** | ❌ 有限 (模型可选) | ❌ 有限 (支持 VSCode 插件) | ❌ 有限 (可自定义 LLM 服务) |
| **运行环境** | ✅ **本地优先**, 可配置任意云端模型 | 云端服务 | 云端服务 | ✅ **本地优先** |
| **开源与成本** | ✅ **开源**, 主要成本为 LLM API (可免费) | 商业闭源, 订阅制 | 商业闭源, 订阅制 | ✅ **开源**, 主要成本为 LLM API |
| **差异化优势** | **极高的灵活性和扩展性**, **工具驱动**, **CLI 原生**, **完全控制数据和模型** | **与 GitHub 生态深度融合**, **代码补全能力强** | **“AI 优先”的 IDE 体验**, **交互流畅** | **专注于纯粹的命令行 Agent 体验** |

---

## 4. 核心应用场景

Jarvis 的强大能力使其能够深度融入日常工作的各个环节，以下是部分核心应用场景的详细阐述。

### 4.1 日常事务处理

利用 Jarvis 的**工具调用**和**自然语言理解**能力，可以自动化处理繁琐的日常办公任务。

- **邮件处理**:
  - **场景**: 收到一封包含多个待办事项和附件的技术支持邮件。
  - **Jarvis 应用**: 结合自定义的邮件读取工具和文件操作工具，Jarvis 可以：
    1.  `'读取最新邮件内容和附件'`
    2.  `'总结邮件要点，并提取待办事项列表'`
    3.  `'将附件下载到本地指定目录'`
    4.  `'根据待办事项起草回复邮件，并交由用户确认发送'`

- **任务管理**:
  - **场景**: 将项目周会的会议纪要转化为团队协作工具（如Jira, Trello）中的具体任务。
  - **Jarvis 应用**:
    1.  `'读取会议纪要文件 a.md'`
    2.  `'分析纪要，识别出每个人的任务、截止日期'`
    3.  `'调用 Jira API 工具，为每个人创建对应的 Task'`

- **汇报材料准备**:
  - **场景**: 根据最近一周的 Git 提交记录和 Jira 任务完成情况，自动生成周报初稿。
  - **Jarvis 应用**:
    1.  `'执行脚本，获取 git log --since="1 week ago"'`
    2.  `'调用 Jira API，获取本周已完成的 Story 和 Bug 列表'`
    3.  `'结合上述信息，按照周报模板生成周报 markdown 文件'`
    
- **信息搜集与整合**:
  - **场景**: 调研“云原生监控领域最新的技术趋势”，并整合成报告。
  - **Jarvis 应用**:
    1.  `'使用 search_web 工具搜索 "cloud native monitoring trends 2024"'`
    2.  `'使用 read_webpage 工具，阅读搜索结果中排名靠前的5篇文章'`
    3.  `'对阅读过的内容进行总结，提取关键技术（如 eBPF, OpenTelemetry, AIops）'`
    4.  `'将总结和关键点整理成一份调研报告'`

### 4.2 开发环境搭建

对于新项目启动或新成员加入，环境搭建往往耗时且易出错。Jarvis 可将此过程变为“一句话的事”。

- **场景**: 为一个新的 Python Web 项目（使用 FastAPI 和 PostgreSQL）搭建完整的本地开发环境。
- **Jarvis 应用** (`jvs`):
  1.  **用户输入**: `'帮我搭建一个 FastAPI 项目的开发环境，需要用到 PostgreSQL 数据库。'`
  2.  **Jarvis 规划与执行**:
      - **规划**: 识别出关键组件：Python, Poetry, Docker, FastAPI, PostgreSQL。
      - **执行**:
        - `'使用 virtual_tty 检查系统是否已安装 a. Python 3.10+ b. Docker c. Poetry'`
        - `'如果 Poetry 未安装，则执行官方安装脚本 curl -sSL https://install.python-poetry.org | python3 -'`
        - `'创建一个名为 "my-fastapi-project" 的新目录并进入'`
        - `'执行 poetry init 初始化项目'`
        - `'执行 poetry add fastapi uvicorn[standard] psycopg2-binary sqlalchemy'`
        - `'创建 docker-compose.yml 文件，内容包含一个 PostgreSQL 服务，并配置好端口和数据卷'`
        - `'使用 virtual_tty 启动 docker-compose up -d'`
        - `'创建项目骨架 main.py, database.py, models.py，并在 main.py 中写入一个连接数据库并返回 "Hello World" 的基本 FastAPI 应用'`
  3.  **结果**: 用户只需一条指令，即可获得一个包含完整依赖、数据库服务已启动、代码骨架已创建的可立即运行的项目环境。

### 4.3 代码开发与重构

这是 Jarvis 的核心价值所在，`jarvis-code-agent` (`jca`) 能够像一名初级开发人员一样，根据需求完成编码任务。

- **新功能开发**:
  - **场景**: 在已有的 FastAPI 项目中，增加一个 `/users` 的 POST 接口，用于创建新用户，并包含数据校验和数据库存储逻辑。
  - **Jarvis 应用** (`jca`):
    1.  **用户输入**: `jca -r "在项目中增加一个创建用户的 POST /users 接口，请求体包含 username 和 email，username 为必填项，email 需符合邮箱格式。将用户信息存入数据库。"`
    2.  **Jarvis 规划与执行**:
        - **分析**: 理解需求，定位到需要修改和创建的文件（`main.py`, `models.py`, `schemas.py`）。
        - **执行**:
          - `'分析 models.py，确认 User 表结构是否存在，如不存在则创建。'`
          - `'创建 schemas.py 文件，并定义 UserCreate 的 Pydantic 模型，包含 username 和 email 字段，并为 email 添加格式校验。'`
          - `'修改 main.py，导入 UserCreate schema，并添加一个新的 @app.post("/users") 路由。'`
          - `'在路由函数中，实现接收请求、数据校验、创建 User 模型实例、存入数据库会话并提交的完整逻辑。'`
          - `'自动格式化修改后的代码，并暂存变更。'`
    3.  **结果**: Jarvis 自动完成相关文件的修改和创建，并生成一个符合规范的 Git commit（通过 `jgc`），用户只需审查和提交。

- **代码重构**:
  - **场景**: 项目中的一个函数 `process_data` 过于庞大（超过200行），逻辑耦合严重，需要将其重构为多个内聚的小函数。
  - **Jarvis 应用** (`jca`):
    1.  **用户输入**: `jca -r "重构 utils.py 文件中的 process_data 函数，将其拆分为多个职责单一的小函数，提高代码可读性和可维护性。"`
    2.  **Jarvis 规划与执行**:
        - `'读取并分析 utils.py 中 process_data 函数的逻辑。'`
        - `'识别出函数内可独立拆分的逻辑块，如：数据加载、数据清洗、数据转换、数据存储。'`
        - `'创建新的私有函数 _load_data, _clean_data, _transform_data, _save_data。'`
        - `'将 process_data 函数的实现，替换为按顺序调用上述新创建的私有函数。'`
        - `'确保重构后的函数签名和返回值与原始函数保持一致，避免破坏性变更。'`
    3.  **结果**: 自动完成复杂函数的重构，将变更应用到文件，并等待用户确认。

### 4.4 故障定位与修复

面对线上突发故障，Jarvis 可以成为快速响应、定位问题的得力助手。

- **场景**: 线上服务出现 500 错误，Sentry 中上报了一个 `KeyError: 'user_id'` 的异常。
- **Jarvis 应用** (`jvs` 或 `jca`):
  1.  **用户输入**: `'Sentry 报警 KeyError: 'user_id'，日志显示错误发生在 'process_order' 函数，帮我定位并修复问题。这是相关的日志片段：[...]'`
  2.  **Jarvis 规划与执行**:
      - **信息收集**:
        - `'读取用户提供的日志，确认错误信息和堆栈。'`
        - `'使用 read_code 工具，读取 'process_order' 函数及其上下文代码。'`
        - `'使用 jarvis-rag query "处理订单时 user_id 为空可能是什么原因？"，查询已录入公司内部技术文档的 RAG 知识库，寻找类似案例。'`
      - **分析与诊断**:
        - 结合代码、日志和 RAG 返回的内部知识（例如：“某些旧版本 APP 的支付回调缺少 user_id”），Jarvis 推断出问题根源：`在处理来自特定渠道的回调时，请求体中缺少 'user_id' 字段`。
      - **修复与验证**:
        - `'使用 edit_file 工具，在访问 'user_id' 之前增加一个条件判断和默认值处理，例如：user_id = data.get('user_id', DEFAULT_USER_ID)'`
        - `'为该修复添加必要的日志记录，以便后续观察。'`
        - `'编写一个单元测试用例，专门模拟缺少 'user_id' 的请求场景，并集成到测试套件中。'`
  3.  **结果**: Jarvis 不仅修复了直接的 `KeyError`，还根据内部知识库提供了更健壮的解决方案，并补充了单元测试以防止问题复发。

### 4.5 DevOps 流程自动化

通过将 Jarvis 的能力与 CI/CD 流水线结合，可以实现更高层次的自动化。

- **场景**: 在代码合并到主分支后，自动完成版本号更新、生成发布日志、构建 Docker 镜像并推送到镜像仓库。
- **Jarvis 应用** (作为 CI/CD 脚本的一部分):
  1.  **触发**: Jenkins / GitLab CI 检测到 `main` 分支有新的合并。
  2.  **执行脚本调用 Jarvis**:
      - **版本更新**: `jca -r "根据 conventional commits 规范，将项目版本号从 $(cat VERSION) 进行 'minor' 级别的提升，并更新到 VERSION 文件中"`
      - **生成发布日志**: `jvs -t "读取 git log --since=<上次发布tag>，总结这段时间的主要变更，包括新功能、修复和重构，生成 CHANGELOG.md 的最新条目"`
      - **构建与推送**:
        - `'读取 VERSION 文件获取最新版本号'`
        - `'执行 docker build -t my-app:$(cat VERSION) .'`
        - `'执行 docker push my-app:$(cat VERSION)'`
        - `'调用自定义工具，通知团队成员新版本已发布'`
  3.  **结果**: 整个发布流程无需人工干预，Jarvis 承担了其中需要智能分析（如判断版本升级类型、总结变更日志）和重复执行（构建、推送）的工作，极大地提升了发布效率和规范性。

---

## 5. 后续发展规划

为了持续提升 Jarvis 的核心竞争力，我们规划了以下发展方向：

- **增强型多 Agent 协作**:
  - **目标**: 从目前的单 Agent 主导或简单的子任务分发，演进为更复杂的、基于角色的多 Agent 协作模式（如模拟“产品经理”、“开发工程师”、“测试工程师”协同工作）。
  - **实施路径**: 引入 Agent 间的通信协议，建立任务协调和状态同步机制，使其能独立完成从需求分析到代码提测的完整闭环。

- **可视化交互界面 (GUI)**:
  - **目标**: 降低使用门槛，为非 CLI 用户提供图形化操作界面。
  - **实施路径**: 开发一个独立的桌面应用或 Web 应用，以可视化的方式展示 Agent 的思考过程、任务规划、文件变更和工具调用结果，并允许用户通过点击、拖拽等方式进行干预和确认。

- **深度 IDE 集成**:
  - **目标**: 将 Jarvis 的强大 Agent 能力无缝嵌入到开发者的日常工作环境中，如 VS Code。
  - **实施路径**: 开发一个 VS Code 插件，实现：
    - 将 `jca` 的代码修改能力与编辑器的“问题”面板和“差异”视图结合。
    - 提供侧边栏聊天窗口，支持 `@file`、`@symbol` 等上下文引用。
    - 将 `jvs` 的终端能力直接集成到 VS Code 的内置终端中。

- **开放生态建设**:
  - **目标**: 打造一个开放的、可共享的工具和方法论社区。
  - **实施路径**:
    - 建立一个公共的**工具市场**，允许用户发布和分享自己的自定义工具。
    - 创建一个**方法论（Methodology）仓库**，鼓励社区贡献针对不同场景（如“数据库性能优化”、“前端组件开发”）的最佳实践工作流，让 Jarvis 可以动态加载并应用。
