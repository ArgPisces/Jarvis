说明
- 优先级：P0 > P1 > P2
- 工作量：S（≤0.5天）、M（0.5–2天）、L（>2天）

## 一、功能与覆盖缺失
- [ ] [P0][M] 在执行前对 arguments 做 JSON Schema 校验（基于 tool.parameters）
  - 统一参数错误提示，避免错误下沉至工具内部
- [ ] [P1][M] 工具分组/标签与可见性控制
  - 支持按组加载、配置集（profiles）快速切换
- [ ] [P1][M] 工具热重载/卸载
  - 支持 CLI reload 或 watch；冲突检测与回退
- [ ] [P2][L] 工具权限/沙箱执行策略
  - 文件系统/环境变量权限限制、签名/白名单、风险提示

## 二、逻辑错误与易错点
- [ ] [P0][S] _extract_tool_calls 返回类型/注释一致化
  - 同步注释、类型标注与实际返回结构
- [ ] [P1][S] 缺失结束标签自动修复需用户确认
  - 打印修复 diff -> user_confirm -> 决定是否采用
- [ ] [P1][M] OutputHandler.handle 返回值语义核对
  - 成功处理应返回 (True, …)（与上层管道契约一致）
- [ ] [P0][M] 禁止将 agent 注入到 args 污染工具参数
  - 改为上下文参数或显式 execute(agent, arguments) 方式
- [ ] [P1][M] register_tool_by_file 约束过强
  - 允许文件内多工具；name 不强绑文件名；冲突时明确报错与建议
- [ ] [P1][M] 模块加载方式改造
  - 用 importlib.spec_from_file_location 按路径加载；清理 sys.modules 避免缓存/污染
- [ ] [P1][S] 统计计数口径优化
  - 区分 attempt/success/failure 或仅成功计数；补充失败计数
- [ ] [P2][S] 清理未使用导入（user_confirm 若未实现确认则移除）

## 三、性能与启动路径
- [ ] [P1][L] ToolRegistry 初始化瘦身
  - 懒加载、异步预取、--fast-start、可配置跳过 daily_check_git_updates
- [ ] [P2][M] prompt() 工具参数拼装缓存
  - 按工具集哈希缓存；变更时失效
- [ ] [P2][M] 外部目录扫描优化
  - 插件清单/manifest 或缓存发现结果，减少 *.py 全量扫描

## 四、健壮性与错误处理
- [ ] [P0][M] YAML 解析失败的可观测性
  - 提供行列信息与带行号片段；附修复示例
- [ ] [P1][S] 多工具调用时的交互提示
  - 列出解析到的 name，建议用户选择或显式索引重试
- [ ] [P1][S] 大输出处理的副作用提示
  - 生成摘要/清理历史前征询用户；或提供“仅截断/上传完整结果”的选项

## 五、扩展性与架构
- [ ] [P2][M] 解耦 ToolRegistry 与 OutputHandler
  - 单一职责：注册/存储 与 调用解析/执行 分离
- [ ] [P2][M] 插件协议与版本化
  - 约束外部工具接口版本；兼容层与 deprecation 提示

## 六、文档与开发者体验
- [ ] [P0][S] 工具调用指南修订与示例补全
  - 明确仅字符串参数使用 |2；数组/对象保持结构；常见报错对照表
- [ ] [P1][S] 开发者指南
  - 工具模板、命名约束（是否等于文件名）、多工具单文件示例
- [ ] [P2][S] CLI 使用文档补充
  - jarvis_tools list/stat/call 示例、返回格式与错误说明
- [ ] [P2][S] 国际化支持
  - 错误与提示信息支持英文（环境变量/配置开关）

## 七、测试与质量保障
- [ ] [P0][M] Registry 关键路径单测
  - 缺失闭合标签修复/确认、多块工具调用、YAML 非法、参数校验失败、重复注册覆盖提示
- [ ] [P1][M] 外部工具加载/冲突/热重载测试
  - 同名工具、同名模块不同目录、文件内多工具、重载缓存一致性
- [ ] [P1][M] MCP 工具注册与异常路径测试
  - 工具列表缺失、必填字段缺失、执行超时/网络异常提示一致性
- [ ] [P2][S] 统计路径测试
  - 成功/失败计数正确聚合与性能基线

## 八、风险与安全
- [ ] [P1][L] 外部 Python 工具执行安全边界
  - 默认关闭或仅信任目录；签名/哈希白名单；沙箱执行策略
- [ ] [P1][M] MCP 远程调用健壮性
  - 统一超时/重试/错误归类；证书/代理配置；日志脱敏

## 里程碑建议
- M1（P0，约1周）
  - 文档拼写/类型标注修复、YAML 错误定位、参数校验、agent 注入方式调整、基础单测与调用示例补全
- M2（P1，2–3周）
  - 外部插件加载重构（importlib 路径加载、多工具/文件、无污染）、热重载 CLI、统计口径优化、prompt 缓存
- M3（P2，>3周）
  - 懒加载/快速启动、权限/沙箱/签名校验、Handler/Registry 解耦、插件协议版本化与性能回归